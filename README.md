# ![NXPlorer logo](/Frontend/nxplorer-black.svg)

# Introduction

This is companion software used to show, ledger and state of the world, updates for Hyperledger Sawtooth. 
Initialy it was created to make a demonstration using multiple MCU's (FRDM-K64F, LPC55S6x and i.MX RT1050) with the addition of a secure elements (EdgeLock™ SE050 by NXP) that were able to interact with a Sawtooth blockchain. We wanted a piece of software that could visualize what was happening behind the scenes.

Now the NXPlorer visualizes the data provided by The Sawtooth API, turning json encoded objects into 'human-readable/visually pleasing' objects

If you would like to recreate the demonstration, [click here](#The-demonstration-setup).

# Project Structure

```bash
NXPlorer/
├── NXPlorer -- #Nodejs file: Main "class"
├── Frontend -- #Folder containing all the frontend files
│   ├── dynamic.js -- #Javascript file: Used to display backend data
│   ├── explorer.js -- #Nodejs file: "Routing" table
│   ├── nxp-logo.svg -- #Svg file: The NXP logo
│   ├── nxplorer-black.svg -- #Svg file: The NXPlorer logo in white
│   ├── nxplorer-white.svg -- #Svg file: The NXPlorer logo in white
│   └── styling.css --  #Css file: Some frontend styling
├── Helpers -- #Folder containing helper files used by the explorer
│   ├── interfaceHelper.js -- #Nodejs file: Used by both interface files to handle messages
│   └── serverHelper.js -- #Nodejs file: Used to set up the interfaces according to the config
├── Interfaces -- #Folder containing interface setup.
│   ├── ethernet.js -- #Nodejs file: Handles ethernet interface setup
│   └── serial.js -- #Nodejs file: Handles serial interface setup
├── package.json -- #Json file: Project settings/dependencies generated by nodejs
├── package-lock.json -- #Json file: Nodejs generated file, please ignore
├── Parsers -- #Folder containing the argument parser files
│   ├── argInterpreter.js -- #Nodejs file: File to interpret the Yargs parsed arguments
│   ├── NotUsed2.js -- #Nodejs file: Not used, previous parser
│   ├── NotUsed.js -- #Nodejs file: Not used, previous parser
│   └── yargsParse.js -- #Nodejs file: The main parser using Yargs
├── README.md -- #Markdown file: The readme file
├── Templates -- #Folder containing the frontend files
│   ├── batches.pug -- #Pug file: template file to construct batches.html
│   ├── blocks.pug -- #Pug file: template file to construct blocks.html
│   ├── index.pug -- #Pug file: template file to construct index.html
│   └── transactions.pug -- #Pug file: template file to construct transactions.html
└── example_config.json -- #Json file: example config file for multi interface setup, if not specified otherwise
```
# Prerequisites
* [Linux (Ubuntu 16.04 LTS)](http://releases.ubuntu.com/16.04/) or Windows
* [Git v2.7.4 or higher](https://git-scm.com/download/linux)
* [Nodejs v10.16.0 or higher](https://nodejs.org/en/download/)
    * Npm v6.7.0 or higher: comes with Nodejs

# Setup guide

*Note*: the following commands where ran, on ubuntu using the default bash and on windows using git bash

* Clone this repository: `git clone https://nxf47943@bitbucket.sw.nxp.com/scm/~nxf47943/nxplorer.git`
* Go inside the NXPlorer directory: `cd NXPlorer`
* Once inside of the this folder, run `npm install`
* The next steps depend on what you plan on doing:
    * You only want to see the ledger.
        * You can edit the [config file](#Creating-or-editing-a-config-file) to have no interface set, and then use: `./NXPlorer multi` (only if you edit the config file, use -c to specify your own config file)
        * Or use the command: `./NXPlorer none`
    * You want to have a setup like the demo (i.e have the NXPlorer act as a interface for devices).
        * You can check the demo setup section, by clicking [here](#The-demonstration-setup)
        * Or use the CLI to see what is available to you, by clicking [here](#Using-the-CLI)
        * The serial/ethernet/multi subcommands are going to be useful.

# Creating or editing a config file

Here is an example of a config file:

```json
{
    "enableExplorer": true,
    "explorerPort": 5000,
    "interfaces": {
        "serial1": {
            "description":"FRDM-K64F not using an SE050",
            "interfaceType": "serial",
            "serialName": "/dev/ttyACM1",
            "baudrate": 115200
        },
        "ethernet1": {
            "description":"i.MX RT1050 using an SE050",
            "interfaceType": "ethernet",
            "ethernetPort": 4444
        }
    },
    "preserveRawFiles" : false,
    "blockchain" : "sawtooth",
    "blockchainAPILocation" : "http://127.0.0.1:8008"
}
```

Here is the explanation of the various parts of the config file:



Parameter            | Explanation                                                                     | Type               | Default    | Possible values
---------------------|---------------------------------------------------------------------------------|--------------------|------------|----------------
**enableExplorer**   | Whether or not you want to enable the NXPlorer frontend                         | Boolean            | `true`     | \
**explorerPort**     | The port on which the NXPlorer frontend is located                              | Integer            | `5000`     | \
**interfaces**       | Object in which al the interfaces are specified                                 | Object<sup>1</sup> | \          | \
**preserveRawFiles** | whether or not you want to keep the raw files produced by the interfaces        | Boolean            | `false`    | \
**blockchain**       | Which blockchain you want to query, this changes frontend, only sawtooth for now | String             | `sawtooth` | `sawtooth`
**blockchainAPILocation** | where the blockhain API interface is located                               | String             | `http://127.0.0.1:8008` | \

This Object<sup>1</sup> can have multiple entries in it, being all the interfaces

Object<sup>1</sup>  | Explaination                                                                         | Type               
--------------------|--------------------------------------------------------------------------------------|--------------------
**name**            | The name of the interface object. Can be anything, don't use duplicates | Object<sup>2</sup> 

This Object<sup>2</sup> can be 1 of 2 things, a serial interface or an ethernet interface

Object<sup>2</sup>  | Explaination                                                                      | Type    | Applicable for                    | Default
--------------------|-----------------------------------------------------------------------------------|---------|-----------------------------------|----------
**description**     | This has no actual use, you can write anything here                               | String  | \                                 | \
**interfaceType**   | This is the type of interface you want to use, the next parameters depend on this | String (serial or ethernet, later wifi) | \ | \
**serialName**      | The name of the serial port, e.g. "/dev/tty" for linux, "COM" for windows         | String  | serial only                       | `/dev/ttyACM1`
**baudrate**        | The speed of communication over the serial data channel                           | Integer | serial only                       | `115200`
**ethernetPort**    | The port on which the RAW tcp server will be started                              | Integer | ethernet only                     | `4444`

# Using the CLI

These are some small examples on how to work with the NXPlorer

1. Getting help can be done by typing:

    ```shell
    $ ./NXPlorer -h
    usage: NXPlorer <command>

    Commands:
    NXPlorer none      Use no interfaces
    NXPlorer serial    Use serial as interface type
    NXPlorer ethernet  Use ethernet as interface type
    NXPlorer multi     Use multiple interfaces using a config

    Options:
    -h, --help  Show help [boolean]
    ```

2. Now we have 4 possibilities, specify `-h` to see what the options for each subcommand are:

    ```shell
    $ ./NXPlorer none -h
    usage: NXPlorer none [options]

    Options:
    -x, --explorerport           Change the NXPlorer port [number] [default: 5000]
    -n, --enableexplorer         When set to false, it wil not start the NXPlorer interface [boolean] [default: true]
    -c, --blockchain             Blockchain to use [string] [choices: "sawtooth"] [default: "sawtooth"]
    -l, --blockchainAPILocation  Location of the blockchain [string] [default: "http://127.0.0.1:8008"]
    -h, --help                   Show help [boolean]
    ```
    ```shell

    $ ./NXPlorer serial -h
    usage: NXPlorer serial [options]

    Options:
    -x, --explorerport              Change the explorer port [number] [default: 5000]  
    -n, --enableexplorer            When set to false, it wil not start the NXPlorer interface [boolean] [default: true]
    -r, --preserveraw               When set to true, it wil not delete the raw files created [boolean] [default: false]
    -p, --serialname                Name of the serial port [string] [default: "/dev/ttyACM1"]
    -b, --baudrate                  Baudrate of the serial port [number] [default: 115200]
    -c, --blockchain                Blockchain to use [string] [choices: "sawtooth"] [default: "sawtooth"]
    -l, --blockchainAPILocation     Location of the blockchain [string] [default: "http://127.0.0.1:8008"]
    -h, --help                      Show help [boolean]
    ```

    ```shell
    $ ./NXPlorer ethernet -h
    usage: NXPlorer ethernet [options]

    Options:
    -x, --explorerport              Change the explorer port [number] [default: 5000]
    -n, --enableexplorer            When set to false, it wil not start the NXPlorer interface [boolean] [default: true]
    -r, --preserveraw               When set to true, it wil not delete the raw files created [boolean] [default: false]
    -e, --ethernetport              Change the ethernet port  [number] [default: 4444]
    -c, --blockchain                Blockchain to use [string] [choices: "sawtooth"] [default: "sawtooth"]
    -l, --blockchainAPILocation     Location of the blockchain [string] [default: "http://127.0.0.1:8008"]
    -h, --help                      Show help [boolean]
    ```

    ```shell
    $ ./NXPlorer multi -h
    usage: NXPlorer multi [options]

    Options:
    -c, --config  Use a json file for configuration [string] [default: "./example_config.json"]
    -h, --help    Show help [boolean]
    ```

3. Lets go over some scenarios:
    * lets say you just finished writing an app for one of your development boards, you want to check if the message is successfully send through serial, you don't need the NXPlorer. The serial port is COM13 and the baudrate is 9600. The following command should do the trick: `./NXPlorer serial -n false -r true -p COM13 -b 9600`

    * You created a multi setup and are ready for deployment. Your setup is located in `/home/user/Documents/NXPlorer_setup.json`. The following command should do the trick: `./NXPlorer multi -c /home/user/Documents/NXPlorer_setup.json`

    * You just received a development board and flashed the SE05X_sawtooth demonstration on it, you just want to try it out. You connect it and see that all settings correspond to the default values. The following command should do the trick: `./NXPlorer serial`

    * You just build an app that uses the RJ45 connection (ethernet) of a development board. You made sure the application sends his TCP connections to port 5000. You want to see the blocks magically appear on the screen, so you decide to open the NXPlorer, but you have used port 5000 already for the TCP connection. You decide on using port 6000 for the NXPlorer. The following command should do the trick: `./NXPlorer ethernet -e 5000 -x 6000`


# The Demonstration setup
For this demonstration you can refer to the application note.

# 

What you will need:
* [Hyperledger Sawtooth v1.1.5](https://www.hyperledger.org/projects/sawtooth) using the Intkey Transaction Family
* A supported NXP development board with or w/o [SE050 development kit](https://www.nxp.com/products/identification-security/authentication/se050-arduino-compatible-development-kit:OM-SE050ARD)
    * [LPC55S6x MCU](https://www.nxp.com/products/processors-and-microcontrollers/arm-based-processors-and-mcus/general-purpose-mcus/lpc5500-cortex-m33/high-efficiency-arm-cortex-m33-based-microcontroller-family:LPC55S6x) with and w/o SE050 development kit

    * [Kinetis® FRDM-K64F](https://www.nxp.com/products/processors-and-microcontrollers/arm-based-processors-and-mcus/general-purpose-mcus/k-series-cortex-m4/k6x-ethernet/kinetis-k64-120-mhz-256kb-sram-microcontrollers-mcus-based-on-arm-cortex-m4-core:K64_120) with and w/o SE050 development kit

    * [i.MX RT1050](https://www.nxp.com/products/processors-and-microcontrollers/arm-based-processors-and-mcus/general-purpose-mcus/k-series-cortex-m4/k6x-ethernet/kinetis-k64-120-mhz-256kb-sram-microcontrollers-mcus-based-on-arm-cortex-m4-core:K64_120) only with SE050 development kit (w/o SE050 development kit might become supported later)

    * other boards might become supported later
* [SE050 Plug & Trust MW v2.10](https://www.nxp.com/webapp/Download?colCode=se050_mw_v02.10.00) (editors note: this package doesn't include the SE05x_sawtooth application yet)
* [MCUXpresso IDE](https://www.nxp.com/support/developer-resources/software-development-tools/mcuxpresso-software-and-tools/mcuxpresso-integrated-development-environment-ide:MCUXpresso-IDE?tab=Design_Tools_Tab) Preferably version 11.x or later.

*Note*: You need to meet the [prerequisites](#Prerequisites) in order for this to be successful

#

Here are the steps for the setup:

1. Run `npm install` inside the `NXPlorer/` folder
2. Make sure the development board(s) is/are flashed and working
3. Connect the board(s) using serial or ethernet
4. Start the Hyperledger Sawtooth blockchain
5. Initialise the key(s) you want to use, *this should be the same as which you have flashed onto the board*, using `intkey set *key* 0` for each key. Some examples we used:
    * `intkey set lpc55_se050 0`
    * `intkey set imxrt1050_se050 0`
    * `intkey set k64f_se050 0`
    * `intkey set lpc55_no_se050 0`
    * `intkey set k64f_no_se050 0`


6. If you are using multiple boards make a config file according to the [example config](./example_config.json) provided. If you need more help creating this file or need to know what all the available options are, [click here](##Creating-or-editing-a-config-file)

7. Choose the cli commands according to your setup
    * if you are using only one board connected using serial use: `./NXPlorer serial`
    * if you are using only one board connected using ethernet use: `./NXPlorer ethernet`
    * if you are using multiple boards connected using ethernet/serial use: `./NXPlorer multi`. Note that this will use the example_config.json file, if you want to use your own file specify the `-c` option and provide your own json file

    * if you aren't sure what all your options are, specify the `-h` option anywhere to get help or [click here](#Using-the-CLI) for help

8. After the previous step is finished, you will have a small log stating the status after setup. In this log you can find the link of the NXPlorer (if you haven't disabled this in your config)

9. Now you should be able to interact with the sawtooth blockchain and see an update on the NXPlorer

# License
See the [LICENSE](./LICENSE) file
